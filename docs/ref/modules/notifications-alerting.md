# Notifications and Alerts in the Dashboard

## Overview

When executed, the Health Check validates that the Notifications and Alerting plugins are available and ensures that a minimal, working configuration exists.
If both plugins are detected, it automatically:

- Creates **default notification channels** (muted by default) for the supported integrations.
- Creates **sample alerting monitors** associated with these channels.
- Logs the verification and creation progress in the Dashboard server logs.

This automation simplifies the setup process and ensures that notifications can be easily configured after installation.

## Concepts

- **Notifications**: allow you to define output channels (for example, Slack, PagerDuty, Jira, or Shuffle) to which the Dashboard will send messages generated by system actions.
- **Alerts**: allow you to define monitors that query Wazuh data and execute actions when conditions are met; among those actions, sending notifications to configured channels.

These functions are part of the Dashboard and may be available depending on the platform installation and configuration.

## Related Health Check Task

The Health Check includes a specific task that streamlines the setup of these capabilities:

- **Task name**: `integrations:default-notifications-channels-and-alerting-monitors`.
- **Function**: verifies the existence of default notification channels and creates them if missing. If the Alerts component is available, it also attempts to create sample monitors pointing to those channels.
- **Creation state**: channels and monitors created by this task are left disabled to facilitate review and configuration before activation.

For general Health Check details, see [Health Check](./healthcheck.md).

## Default Notification Channels Created

When the Notifications functionality is available in the Dashboard, the Health Check creates (if they don't exist) the following channels. All are created disabled:

| Channel               | Description                                                                         | Configuration                                                                                                                                                                                            |
| --------------------- | ----------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Slack Channel**     | Sends notifications via Slack Incoming Webhook.                                     | [Create a Slack webhook](https://api.slack.com/messaging/webhooks) and set the Webhook URL.                                                                                                              |
| **PagerDuty Channel** | Sends alerts via the **Events v2 API** (`https://events.pagerduty.com/v2/enqueue`). | [Create a PagerDuty Events v2 integration](https://developer.pagerduty.com/docs/events-api-v2-overview) and set your Integration Key in the `X-Routing-Key` header.                                      |
| **Jira Channel**      | Creates issues via Jira REST API.                                                   | [Create a Jira API token](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/) and configure the URL with `Authorization: Basic base64(email:api_token)`. |
| **Shuffle Channel**   | Triggers Shuffle workflows via webhook.                                             | [Get your Shuffle workflow webhook URL](https://shuffler.io/docs/triggers#webhook-example) and paste it in the configuration.                                                                            |

> All channels are stored as saved objects under the `Global` tenant with names like `Slack Channel`, `PagerDuty Channel`, etc.

Security recommendations: treat these URLs and credentials as secrets. Review permissions and channel visibility before enabling it.

## Sample Monitors Created

If the Alerts functionality is available, the Health Check attempts to create the following sample monitors on the Wazuh alerts index pattern (`wazuh-alerts-*`):

| Monitor name        | Target channel    | Behavior                                                                                     |
| ------------------- | ----------------- | -------------------------------------------------------------------------------------------- |
| `Sample: Slack`     | Slack Channel     | Queries for alerts with `rule.level > 3` and sends notifications to Slack.                   |
| `Sample: PagerDuty` | PagerDuty Channel | Queries for alerts with `rule.level > 3` and sends sample events to PagerDuty via Events v2. |
| `Sample: Jira`      | Jira Channel      | Queries for alerts with `rule.level > 3` and triggers a mock issue creation.                 |
| `Sample: Shuffle`   | Shuffle Channel   | Queries for alerts with `rule.level > 3` and sends a test payload to the Shuffle workflow.   |

> If a required channel does **not** exist, the monitor will **not** be created.

You can review the created monitors under `Explore â†’ Alerting â†’ Monitors`.
For more information about monitor configuration, see the official OpenSearch documentation:
ðŸ”— [OpenSearch Alerting Monitors Documentation](https://docs.opensearch.org/latest/observing-your-data/alerting/monitors/)

## Steps to Complete the Configuration

1. Configure and enable the notification channel

   - Go to `Explore > Notifications > Channels` and open one of the default channels (Slack, PagerDuty, Jira, or Shuffle).
   - Provide the required endpoint or credentials, replacing the placeholders with real values:
     - **Slack**: specify the Incoming Webhook URL obtained from your Slack workspace.
     - **PagerDuty**: keep the default URL and set your Integration Key in the `X-Routing-Key` header.
     - **Jira**: specify your instance URL and configure `Authorization: Basic <base64(email:api_token)>`.
     - **Shuffle**: specify the Webhook URL of the workflow you will use.
   - Save and unmuted/enable the channel when the test is successful.

   Test notes:

   - **Slack**: you can validate the channel by sending a test message from the Notifications interface.
   - **Jira** and **PagerDuty**: effective validation is performed by executing the action from a monitor (see point 2). This is the recommended way to confirm delivery.

2. Connect and enable the sample monitors

   - Go to `Explore > Alerting > Monitors` and open the corresponding `Sample: <Channel>` monitor.
   - If it has no action, add "Send notification" and select the previously configured channel; if it already exists, verify that it points to the correct channel.
   - Adjust the subject/message template if necessary and enable the monitor.

3. Run the Health Check again
   - Open `Dashboard management > Health Check` and run the checks. Once channels and monitors are enabled, the related checks should pass to a healthy state.

## Enable Only Notification Checks

To exclusively enable notification-related checks through configuration:

```yml
healthcheck.checks_enabled: 'notification-channel'
```

Or, to explicitly target the task described above:

```yml
healthcheck.checks_enabled: 'integrations:default-notifications-channels-and-alerting-monitors'
```

## Logs and Troubleshooting

The Health Check logs detailed progress information during verification and setup.
Examples of log entries include:

```
server    log   [15:03:45.031] [info][healthcheck][integrations:default-notifications-channels-and-alerting-monitors] All default notification channels are now present and verified
server    log   [15:18:45.030] [info][healthcheck][integrations:default-notifications-channels-and-alerting-monitors] Starting Alerting sample monitors check
server    log   [15:18:45.041] [info][healthcheck][integrations:default-notifications-channels-and-alerting-monitors] Monitor already exists [Sample: Slack]
server    log   [15:18:44.971] [info][healthcheck][integrations:default-notifications-channels-and-alerting-monitors] Starting verification of default notification channels
```

If a check fails, review these log entries for details on which resource was missing or misconfigured.

## Useful Links and References

- [Health Check](./healthcheck.md).
- Slack â€“ [Incoming Webhooks](https://api.slack.com/messaging/webhooks): official guide to create and obtain the URL.
- Monitors - [opensearch](https://docs.opensearch.org/latest/observing-your-data/alerting/monitors/)
